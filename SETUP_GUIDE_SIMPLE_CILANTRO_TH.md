# คู่มือการติดตั้งระบบรดน้ำผักชีฟลั่งอัตโนมัติ (เวอร์ชันเรียบง่าย)

## 🌿 ระบบเรียบง่าย - ใช้งานง่าย เสถียร

### ✨ คุณสมบัติของระบบ
- 💧 **รดน้ำอัตโนมัติ**: ควบคุมด้วยความชื้นดินเท่านั้น (เรียบง่าย)
- 📶 **WiFi Manager**: เลือกเครือข่าย WiFi ผ่าน Captive Portal (Hotspot)
- 🌐 **เว็บในเครื่อง**: แสดงสถานะระบบผ่านเว็บเบราว์เซอร์ภายในเครื่อง
- 🚫 **ไม่มีบริการภายนอก**: ไม่ต้องพึ่งพา Internet หรือ Cloud
- 💾 **บันทึกอัตโนมัติ**: บันทึกการตั้งค่าใน EEPROM
- 🔄 **รีเซ็ต WiFi**: กดปุ่ม Boot ค้างไว้ 5 วินาทีเพื่อรีเซ็ต WiFi
- ⏰ **ตรรกะตามเวลา**: ใช้เวลาในการควบคุมการรดน้ำ

---

## 📦 อุปกรณ์ที่ต้องใช้ (เรียบง่าย)

### ✅ อุปกรณ์หลักเท่านั้น
- **ESP32 Development Board** (1 ตัว)
- **DS3231 RTC Module** (1 ตัว)
- **Soil Moisture Sensor** (3 ตัว)
- **Relay Module 5V** (3 ตัว)
- **Water Pump 12V** (3 ตัว)
- **LED สถานะ** (1 ตัว)
- **ตัวต้านทาน 220Ω** (1 ตัว)

### ❌ อุปกรณ์ที่ไม่ต้องใช้แล้ว (ประหยัด)
- ~~DHT22 Temperature & Humidity Sensor~~
- ~~Light Sensor (LDR/Photoresistor)~~
- ~~ตัวต้านทาน 10kΩ สำหรับ Light Sensor~~
- ~~Blink Camera และอุปกรณ์เกี่ยวข้อง~~
- ~~สายต่อสำหรับเซ็นเซอร์เสริม~~

### 🔌 อุปกรณ์เสริม
- **Power Supply 12V** (สำหรับปั๊มน้ำ)
- **Jumper Wires**
- **Breadboard** หรือ **PCB**
- **กล่องกันน้ำ** (สำหรับ ESP32)

---

## 📚 การติดตั้ง Library

### 1. เปิด Arduino IDE

### 2. ติดตั้ง ESP32 Board Support
```
File > Preferences > Additional Board Manager URLs:
https://raw.githubusercontent.com/espressif/arduino-esp32/gh-pages/package_esp32_index.json
```

### 3. ติดตั้ง Libraries ที่จำเป็น
ไปที่ `Tools > Manage Libraries` และค้นหาติดตั้ง:

#### ✅ Libraries ที่ต้องติดตั้ง (3 ตัวเท่านั้น)
1. **RTClib** by Adafruit (v2.1.1+)
2. **ArduinoJson** by Benoit Blanchon (v6.21.3+)
3. **WiFiManager** by tzapu (v2.0.16-rc.2+)

#### 🔧 Built-in Libraries (ติดตั้งอัตโนมัติ)
- WiFi (ESP32)
- WebServer (ESP32)
- Wire (I2C)
- EEPROM (ESP32)

#### ❌ Libraries ที่ไม่ต้องใช้แล้ว
- ~~DHT sensor library~~
- ~~Light sensor library~~
- ~~Blink API libraries~~

---

## 🔌 การต่อสายไฟ (เรียบง่าย)

### ESP32 Pin Configuration

#### 📡 Digital Pins
```
GPIO 0  ──── Boot Button (รีเซ็ต WiFi)
GPIO 2  ──── Status LED (+ ตัวต้านทาน 220Ω ต่อ GND)
GPIO 4  ──── [FREE PIN] ว่างแล้ว (สำหรับขยายระบบ)
GPIO 5  ──── Relay 1 (Zone 1)
GPIO 18 ──── Relay 2 (Zone 2)
GPIO 19 ──── Relay 3 (Zone 3)
GPIO 21 ──── Flow Sensor (ถ้ามี)
GPIO 22 ──── RTC SDA (I2C Data)
GPIO 23 ──── RTC SCL (I2C Clock)
```

#### 📊 Analog Pins
```
GPIO 34 ──── Soil Moisture Sensor 3
GPIO 35 ──── [FREE PIN] ว่างแล้ว (สำหรับขยายระบบ)
GPIO 36 ──── Soil Moisture Sensor 1
GPIO 39 ──── Soil Moisture Sensor 2
```

### 🔌 รายละเอียดการต่อสาย

#### 1. DS3231 RTC Module
```
RTC VCC ──── ESP32 3.3V
RTC GND ──── ESP32 GND
RTC SDA ──── ESP32 GPIO 22
RTC SCL ──── ESP32 GPIO 23
```

#### 2. Soil Moisture Sensors (3 ตัว)
```
Sensor 1:  VCC ──── 3.3V,  GND ──── GND,  A0 ──── GPIO 36
Sensor 2:  VCC ──── 3.3V,  GND ──── GND,  A0 ──── GPIO 39
Sensor 3:  VCC ──── 3.3V,  GND ──── GND,  A0 ──── GPIO 34
```

#### 3. Relay Modules (3 ตัว)
```
Relay 1:  VCC ──── 5V,  GND ──── GND,  IN ──── GPIO 5
Relay 2:  VCC ──── 5V,  GND ──── GND,  IN ──── GPIO 18
Relay 3:  VCC ──── 5V,  GND ──── GND,  IN ──── GPIO 19
```

#### 4. Water Pumps
```
Pump 1:  (+) ──── Relay 1 NO,  (-) ──── Power Supply GND
Pump 2:  (+) ──── Relay 2 NO,  (-) ──── Power Supply GND
Pump 3:  (+) ──── Relay 3 NO,  (-) ──── Power Supply GND
```

#### 5. Status LED
```
LED Anode ──── GPIO 2 ──── 220Ω Resistor ──── GND
```

---

## 💻 การติดตั้งโค้ด

### 1. เปิด Arduino IDE
### 2. เลือก Board: `ESP32 Dev Module`
### 3. Copy โค้ดจากไฟล์ `cilantro_watering_system.ino`
### 4. Upload ไปยัง ESP32

---

## 📶 การตั้งค่า WiFi (WiFi Manager)

### 🚀 การตั้งค่าครั้งแรก

1. **Upload โค้ด** ไปยัง ESP32
2. **รอ ESP32 สร้าง Hotspot**
   - ชื่อ: `CilantroWatering-Setup`
   - รหัสผ่าน: `cilantro123`

3. **เชื่อมต่อ WiFi**
   - ใช้มือถือหรือคอมพิวเตอร์เชื่อมต่อ Hotspot
   - เบราว์เซอร์จะเปิดหน้าตั้งค่าอัตโนมัติ
   - หรือไปที่ `http://192.168.4.1`

4. **เลือกเครือข่าย WiFi**
   - เลือกเครือข่าย WiFi ที่ต้องการ
   - ใส่รหัสผ่าน WiFi
   - (ทางเลือก) ใส่ Webhook URL

5. **บันทึกและรีสตาร์ท**
   - กด Save Configuration
   - ESP32 จะรีสตาร์ทและเชื่อมต่อ WiFi อัตโนมัติ

### 🔄 การรีเซ็ต WiFi

#### วิธีที่ 1: ใช้ปุ่ม Boot
1. **กดปุ่ม Boot** บน ESP32 ค้างไว้ **5 วินาที**
2. ESP32 จะรีสตาร์ทและเปิด Hotspot สำหรับตั้งค่าใหม่

#### วิธีที่ 2: ใช้เว็บอินเตอร์เฟส
1. เข้าเว็บอินเตอร์เฟสระบบ
2. กดปุ่ม **"🔄 รีเซ็ต WiFi"**
3. ยืนยันการรีเซ็ต

---

## 🌐 การใช้งานเว็บอินเตอร์เฟส (เรียบง่าย)

### 📊 หน้าแสดงสถานะ
- **📶 WiFi Signal**: ความแรงสัญญาณ WiFi
- **⏱️ System Uptime**: เวลาที่ระบบทำงาน
- **🕒 Current Time**: เวลาปัจจุบันของระบบ
- **💧 Total Watering Today**: จำนวนครั้งที่รดน้ำวันนี้
- **💾 Free Memory**: หน่วยความจำที่เหลือ
- **🌐 System Status**: สถานะระบบ

### 🌿 การแสดงโซน
แต่ละโซนจะแสดง:
- ชื่อโซนและสถานะ
- ความชื้นดินปัจจุบัน
- ความชื้นดินเป้าหมาย
- ระยะการเจริญเติบโต
- จำนวนครั้งที่รดน้ำวันนี้
- สถานะการรดน้ำ

### 🎛️ การควบคุม
- **💧 รดน้ำโซน 1-3**: รดน้ำด้วยตนเอง
- **📊 ข้อมูลระบบ**: ดูข้อมูลระบบโดยละเอียด
- **🔄 รีเซ็ต WiFi**: รีเซ็ต WiFi และรีสตาร์ท
- **🚨 หยุดฉุกเฉิน**: หยุดการรดน้ำทั้งหมดทันที

---

## ⚙️ การตั้งค่าระบบ

### 🌱 พารามิเตอร์ผักชีฟลั่ง

#### ความชื้นดิน:
- **ขั้นต่ำ**: 45% (เริ่มรดน้ำ)
- **ขั้นสูง**: 75% (หยุดรดน้ำ)

#### ตรรกะตามเวลา:
- **เช้า-เย็น**: 08:00-18:00 น. (เพิ่มการรดน้ำ)
- **กลางวัน**: 10:00-16:00 น. (รดน้ำนานขึ้น 10%)
- **กลางคืน**: 20:00-06:00 น. (รดน้ำสั้นลง 10%)

### ⏰ กำหนดการรดน้ำ
- **เช้า**: 6:00, 6:05, 6:10 น.
- **เย็น**: 18:00, 18:05, 18:10 น.
- **ระยะเวลา**: 2-8 นาที (ขึ้นอยู่กับโซน)

---

## 🔧 การแก้ไขปัญหา

### 📶 ปัญหา WiFi

#### ไม่เจอ Hotspot "CilantroWatering-Setup":
- ตรวจสอบการต่อสายปุ่ม Boot (GPIO 0)
- กดปุ่ม Reset บน ESP32
- ตรวจสอบว่า Upload โค้ดสำเร็จแล้ว

#### เชื่อมต่อ WiFi ไม่ได้:
- ตรวจสอบรหัสผ่าน WiFi
- ใช้เครือข่าย 2.4GHz (ESP32 ไม่รองรับ 5GHz)
- ตรวจสอบความแรงสัญญาณ

### 🌡️ ปัญหาเซ็นเซอร์

#### เซ็นเซอร์ความชื้นดินอ่านค่าไม่ได้:
- ตรวจสอบไฟ 3.3V ไปยังเซ็นเซอร์
- ตรวจสอบการต่อสาย Analog (GPIO 36, 39, 34)
- ตรวจสอบ GND ต่อครบทุกตัว

### ⚡ ปัญหารีเลย์

#### รีเลย์ไม่ทำงาน:
- ตรวจสอบไฟ 5V ไปยังรีเลย์
- ตรวจสอบสายสัญญาณควบคุม (GPIO 5, 18, 19)
- ทดสอบรีเลย์ด้วย Multimeter

#### ปั๊มน้ำไม่ทำงาน:
- ตรวจสอบไฟ 12V ไปยังปั๊ม
- ตรวจสอบการต่อสาย COM และ NO ของรีเลย์
- ทดสอบปั๊มแยกจากระบบ

### 🕒 ปัญหา RTC

#### เวลาไม่ถูกต้อง:
- ตรวจสอบการต่อ I2C (SDA=GPIO 22, SCL=GPIO 23)
- ตรวจสอบไฟ 3.3V ไปยัง RTC
- ใส่ถ่าน CR2032 ใน RTC Module

---

## 🛡️ ข้อควรระวัง

### ⚡ ความปลอดภัยไฟฟ้า
- ใช้ Power Supply ที่มีกำลังเพียงพอ
- ตรวจสอบการต่อสายให้แน่นหนา
- ใช้รีเลย์ที่มี Optocoupler
- ต่อ GND ร่วมกันทุกอุปกรณ์

### 💧 ความปลอดภัยน้ำ
- เก็บอุปกรณ์อิเล็กทรอนิกส์ให้ห่างจากน้ำ
- ใช้ข้อต่อกันน้ำสำหรับเซ็นเซอร์กลางแจ้ง
- ติดตั้งระบบระบายน้ำที่เหมาะสม
- ใช้ GFCI สำหรับการป้องกัน

### 🔧 การป้องกันอุปกรณ์
- ใส่ตัวต้านทาน 220Ω สำหรับ LED
- ตรวจสอบกำลังรีเลย์ให้รองรับปั๊ม
- ใส่ Flyback Diode ข้างปั๊มมอเตอร์
- ต่อ GND ร่วมกันทุกอุปกรณ์

---

## 🚀 การปรับปรุงระบบ

### 📌 Pin ที่ว่างสำหรับขยายระบบ
- **GPIO 4**: ว่างแล้วหลังลบ DHT22
- **GPIO 35**: ว่างแล้วหลังลบ Light Sensor
- **GPIO 12-17**: สำหรับเซ็นเซอร์เพิ่มเติม
- **GPIO 25-27**: สำหรับ PWM หรือ Analog

### 🌟 ไอเดียการปรับปรุง
- **เซ็นเซอร์ pH**: ติดตั้งที่ GPIO 4
- **เซ็นเซอร์อุณหภูมิ DS18B20**: ติดตั้งที่ GPIO 35
- **เซ็นเซอร์ฝน**: ป้องกันการรดน้ำตอนฝนตก
- **เซ็นเซอร์ระดับน้ำ**: ตรวจสอบน้ำในถัง
- **ระบบ PWM**: ควบคุมความเร็วปั๊ม
- **Solar Panel**: ระบบพลังงานแสงอาทิตย์

### 🌐 ฟีเจอร์ที่ไม่ต้องมี (เรียบง่าย)
- ~~Cloud Monitoring~~ (ไม่ต้องพึ่งพาอินเทอร์เน็ต)
- ~~External API~~ (ทำงานได้แม้ไม่มีเน็ต)
- ~~Complex Sensors~~ (ใช้เฉพาะที่จำเป็น)

---

## 📞 การสนับสนุน

### 🔍 การตรวจสอบระบบ
- **Serial Monitor**: ดูข้อความสถานะระบบ
- **Web Interface**: ตรวจสอบค่าเซ็นเซอร์
- **LED Status**: สังเกตการกระพริบของ LED
- **System Info Modal**: ดูข้อมูลระบบโดยละเอียด

### 📋 ข้อความสำคัญใน Serial Monitor
```
✅ WiFi connected! IP: xxx.xxx.xxx.xxx
🌐 Web server started
🌿 Simple Cilantro Watering System Ready!
💧 Started watering Zone X for Y minutes
🔄 WiFi reset requested
```

### 🆘 ขอความช่วยเหลือ
หากพบปัญหาที่แก้ไขไม่ได้:
1. บันทึกข้อความจาก Serial Monitor
2. ถ่ายรูปการต่อสายไฟ
3. อธิบายปัญหาที่เกิดขึ้นโดยละเอียด
4. ระบุขั้นตอนที่ทำก่อนปัญหาเกิด

---

## ✅ Checklist การติดตั้ง

### 📦 เตรียมอุปกรณ์
- [ ] ESP32 Development Board
- [ ] DS3231 RTC Module  
- [ ] Soil Moisture Sensors (3 ตัว)
- [ ] Relay Modules (3 ตัว)
- [ ] Water Pumps (3 ตัว)
- [ ] LED และตัวต้านทาน 220Ω
- [ ] Power Supply 12V
- [ ] สายไฟและอุปกรณ์ต่อ

### 💻 ติดตั้งซอฟต์แวร์
- [ ] ติดตั้ง Arduino IDE
- [ ] ติดตั้ง ESP32 Board Support
- [ ] ติดตั้ง RTClib Library
- [ ] ติดตั้ง ArduinoJson Library
- [ ] ติดตั้ง WiFiManager Library
- [ ] Upload โค้ดไปยัง ESP32

### 🔌 ต่อสายไฟ
- [ ] ต่อ DS3231 RTC (I2C)
- [ ] ต่อ Soil Moisture Sensors (3 ตัว)
- [ ] ต่อ Relay Modules (3 ตัว)
- [ ] ต่อ Water Pumps
- [ ] ต่อ Status LED
- [ ] ต่อ Power Supply

### 📶 ตั้งค่า WiFi
- [ ] เชื่อมต่อ Hotspot "CilantroWatering-Setup"
- [ ] เลือกเครือข่าย WiFi
- [ ] ใส่รหัสผ่าน WiFi
- [ ] บันทึกการตั้งค่า
- [ ] ตรวจสอบการเชื่อมต่อ WiFi

### ✅ ทดสอบระบบ
- [ ] ตรวจสอบค่าเซ็นเซอร์ในเว็บ
- [ ] ทดสอบการรดน้ำด้วยตนเอง
- [ ] ตรวจสอบการทำงานของรีเลย์
- [ ] ทดสอบการทำงานของปั๊มน้ำ
- [ ] ตรวจสอบ LED สถานะ
- [ ] ทดสอบการรีเซ็ต WiFi

---

## 🎯 สรุป

ระบบรดน้ำผักชีฟลั่งอัตโนมัติเวอร์ชันเรียบง่ายนี้:

### ✨ จุดเด่น
- **เรียบง่ายที่สุด**: ใช้เฉพาะอุปกรณ์ที่จำเป็น
- **เสถียรสูง**: ไม่พึ่งพาบริการภายนอก
- **ใช้งานง่าย**: ตั้งค่าและควบคุมผ่านเว็บเบราว์เซอร์
- **ประหยัด**: อุปกรณ์น้อย ราคาถูก
- **ยืดหยุ่น**: สามารถขยายระบบได้ง่าย
- **ไม่ต้องพึ่งอินเทอร์เน็ต**: ทำงานได้แม้ไม่มีเน็ต

### 🌿 เหมาะสำหรับ
- **ผู้เริ่มต้น**: ติดตั้งและใช้งานง่าย
- **งบประมาณจำกัด**: ใช้อุปกรณ์น้อย
- **ต้องการความเสถียร**: ระบบเรียบง่าย เสียหายน้อย
- **การใช้งานพื้นฐาน**: รดน้ำอัตโนมัติตามความชื้นดิน

### 🎉 ข้อสรุป
ระบบนี้**เน้นความเรียบง่าย เสถียร และใช้งานง่าย**
เหมาะสำหรับผู้ที่ต้องการระบบรดน้ำอัตโนมัติที่**ไม่ซับซอน แต่มีประสิทธิภาพ**

🌱 **ขอให้มีความสุขกับการปลูกผักชีฟลั่ง!** 🌱